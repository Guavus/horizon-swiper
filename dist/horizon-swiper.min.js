"use strict";var $=require("jquery"),pluginName="horizonSwiper",settings={item:".horizon-item",showItems:"auto",dots:!1,numberedDots:!1,arrows:!0,arrowPrevText:"",arrowNextText:"",animationSpeed:500,mouseDrag:!0,onStart:function(){},onEnd:function(){},onSlideStart:function(){},onSlideEnd:function(){},onDragStart:function(){},onDragEnd:function(){}},defaults={$window:$(window),$document:$(document),innerClass:"horizon-inner",outerClass:"horizon-outer",dotContainer:'<nav class="horizon-dots"></nav>',arrowPrev:['<button class="horizon-prev">',"</button>"],arrowNext:['<button class="horizon-next">',"</button>"],showArrowsClass:"arrows",showDotsClass:"dots",initializedClass:"initialized",mouseDragClass:"mouse-drag",firstItemClass:"first-item",lastItemClass:"last-item"},HorizonSwiper=function(){function a(a,b){var c=this;c.settings=$.extend({},settings,b),c.$element=$(a),c.$items=c.$element.find(this.settings.item),c.$inner=null,c.$outer=null,c.$dots=null,c.$arrowPrev=null,c.$arrowNext=null,c.initialized=!1,c.maxHeight=0,c.innerContainerWidth=0,c.viewportSize=0,c.isAnimate=!1;var d=function a(){c.initialized?c.setSizes():setTimeout(function(){a()},1e3)};defaults.$document.ready(function(){c.init()}),defaults.$window.load(function(){d()})}return a.prototype.init=function(){var a=this;a._setWrapper(),a._addArrows(),a._addDots(),a._mouseDrag(),a.setSizes(),a._resize(),a._checkPosition(),a.initialized=!0},a.prototype.setSizes=function(){var a=this;a.maxHeight=0,a.innerContainerWidth=0;for(var b=0;b<a.$items.length;++b){var c=$(a.$items[b]),d=(c.outerHeight(!0),c.outerWidth(!0));a.innerContainerWidth+=d}a.viewportSize=a.$inner.width(),a.viewportSize<a.innerContainerWidth?(a.$element.addClass(defaults.initializedClass),a.settings.arrows&&a.$element.addClass(defaults.showArrowsClass),a.settings.dots&&a.$element.addClass(defaults.showDotsClass)):(a.$element.removeClass(defaults.initializedClass),a.$element.addClass(defaults.showArrowsClass))},a.prototype.currentId=0,a.prototype._resize=function(){var b=this,c=function(){b.setSizes();var c=$(b.$items[0]),d=c.outerWidth(!0);b.$inner.scrollLeft(d*a.prototype.currentId)};defaults.$window.resize(function(){c()})},a.prototype._setWrapper=function(){var a=this,b=0;a.$items.wrapAll('<div class="'+defaults.outerClass+'">'),a.$items.wrapAll('<div class="'+defaults.innerClass+'">'),a.$inner=a.$element.find("."+defaults.innerClass),a.$outer=a.$element.find("."+defaults.outerClass),"auto"!==a.settings.showItems&&a.settings.showItems===parseInt(a.settings.showItems,10)&&(b=100/a.settings.showItems,a.$items.css({width:b+"%"}));for(var c=0;c<a.$items.length;++c)$(a.$items[c]).attr("data-horizon-index",c)},a.prototype._addDots=function(){var a=this;if(a.settings.dots){a.$dots=$(defaults.dotContainer);for(var b=0;b<a.$items.length;++b){var c=a.settings.numberedDots?b:"",d=$('<button class="horizon-dot" data-horizon-target="'+b+'">'+c+"</button>");a.$dots.append(d)}a.$element.append(a.$dots),a.$dots.find("button").on("click",function(b){b.preventDefault();var c=$(this).attr("data-horizon-target");a._dotScroll(c)})}},a.prototype._dotScroll=function(a){var b=this,c=b.$dots.find('[data-horizon-index="'+a+'"]'),d=c.outerWidth(!0),e=0,f=0,g=b.viewportSize/2-d/2;b.isAnimate=!0,b.settings.onSlideStart();for(var h=0;h<b.$items.length;++h)h<a&&(e+=$(b.$items[h]).outerWidth(!0));f=e-g,f<0?f=0:f>b.innerContainerWidth-b.viewportSize&&(f=b.innerContainerWidth-b.viewportSize),b.$inner.animate({scrollLeft:f},b.settings.animationSpeed,function(){b._checkPosition(),b.settings.onSlideEnd(),a===b.$items.length?b.settings.onEnd():0===a&&b.settings.onStart(),b.isAnimate=!1})},a.prototype._addArrows=function(){var a=this;!0===a.settings.arrows&&(a.$arrowPrev=$(defaults.arrowPrev[0]+a.settings.arrowPrevText+defaults.arrowPrev[1]),a.$arrowNext=$(defaults.arrowNext[0]+a.settings.arrowNextText+defaults.arrowNext[1]),a.$arrowNext.insertAfter(a.$outer),a.$arrowPrev.insertAfter(a.$outer),a.$element.addClass(defaults.firstItemClass),a.$arrowPrev.attr("disabled","disabled"),a.$arrowPrev.on("click",function(b){b.preventDefault(),a.isAnimate||a._scrollTo("previous")}),a.$arrowNext.on("click",function(b){b.preventDefault(),a.isAnimate||a._scrollTo("next")}),a.$element.on("slideToId",function(b,c){a._scrollToId(c)}))},a.prototype._scrollToId=function(b){a.prototype.currentId=b;var c=this,d=c._getOffsetById(b);if(c.isAnimate=!0,"end"===d||"start"===d)return void(c.isAnimate=!1);c.settings.onSlideStart(),c.$inner.animate({scrollLeft:d[0]},c.settings.animationSpeed,function(){"end"===d[1]?c.settings.onEnd():"start"===d[1]&&c.settings.onStart(),c._checkPosition(),c.settings.onSlideEnd(),c.isAnimate=!1})},a.prototype._getOffsetById=function(a){var b=this,c=$(b.$items[a]).outerWidth(!0),d="";return a===b.$items.length-1?d="end":0===a&&(d="start"),[c*a,d]},a.prototype._scrollTo=function(a){var b=this,c=b._getOffset(a);if(b.isAnimate=!0,"end"===c||"start"===c)return void(b.isAnimate=!1);b.settings.onSlideStart(),b.$inner.animate({scrollLeft:c[0]},b.settings.animationSpeed,function(){"end"===c[1]?b.settings.onEnd():"start"===c[1]&&b.settings.onStart(),b._checkPosition(),b.settings.onSlideEnd(),b.isAnimate=!1})},a.prototype._getOffset=function(a){var b=this,c=b.$inner.scrollLeft(),d=0,e=c+b.viewportSize;if("next"===a&&c+b.viewportSize===b.innerContainerWidth)return"end";if("previous"===a&&0===c)return"start";for(var f=0;f<b.$items.length;++f){var g=$(b.$items[f]).outerWidth(!0),h="";if(d+=g,"next"===a&&d>e)return f+1===b.$items.length&&(h="end"),[d-b.viewportSize,h];if("previous"===a&&d>=c)return d-g<=0&&(h="start"),[d-g,h]}},a.prototype._mouseDrag=function(){var a=this,b=!1,c=!1,d=0,e=0,f=(a.$inner.offset().left,0),g=!1,h=!1,i=null,j=function(c){b||(f=e+(d-c.pageX),a.$inner.scrollLeft(f))};a.$element.on({touchstart:function(c){b=!0,g=!0,h=!0,a.settings.onDragStart()}}),defaults.$document.on({touchend:function(b){g&&(a._checkPosition(),a.settings.onDragEnd(),g=!1)}}),a.$inner.scroll(function(){clearTimeout(i),i=setTimeout(function(){h&&(a._checkPosition(),a.settings.onDragEnd(),h=!1)},250)}),a.settings.mouseDrag&&!b&&(a.$element.addClass(defaults.mouseDragClass),a.$element.on({mousedown:function(b){c=!0,d=b.pageX,e=a.$inner.scrollLeft(),"button"!==b.target.tagName.toLowerCase()&&a.settings.onDragStart()}}),defaults.$document.on({mousemove:function(a){c&&j(a)},mouseup:function(b){c&&"button"!==b.target.tagName.toLowerCase()&&(a._checkPosition(),a.settings.onDragEnd()),c=!1}}))},a.prototype._checkPosition=function(){var a=this,b=a.$inner.scrollLeft();a.settings.arrows&&a._checkArrowState(b),a.settings.dots&&a._checkActiveDots(b)},a.prototype._checkActiveDots=function(a){for(var b=this,c=0,d=0,e=[a,a+b.viewportSize],f=0;f<b.$items.length;++f){var g=$(b.$items[f]),h=g.outerWidth(!0);d+=h,c+h/2>=e[0]&&d-h/2<=e[1]?b.$dots.find('[data-horizon-target="'+f+'"]').addClass("active"):b.$dots.find('[data-horizon-target="'+f+'"]').removeClass("active"),c+=h}},a.prototype._checkArrowState=function(a){var b=this;a+b.viewportSize>=b.innerContainerWidth-1?(b.$element.addClass(defaults.lastItemClass),b.$arrowNext.attr("disabled","disabled"),b.$element.removeClass(defaults.firstItemClass),b.$arrowPrev.removeAttr("disabled")):a<=0?(b.$element.addClass(defaults.firstItemClass),b.$arrowPrev.attr("disabled","disabled"),b.$element.removeClass(defaults.lastItemClass),b.$arrowNext.removeAttr("disabled")):(b.$element.removeClass(defaults.lastItemClass).removeClass(defaults.firstItemClass),b.$arrowPrev.removeAttr("disabled"),b.$arrowNext.removeAttr("disabled"))},a}();$.fn[pluginName]=function(a){return this.each(function(){$.data(this,pluginName)||$.data(this,pluginName,new HorizonSwiper(this,a))}),this};